clear
close all
clc

addpath('./box_drowing/');

% COMMENTO 

%Variabili globali
Nb=8;

% Inizializzazione variabili utili

%Mult_VMAT



% Funzioni
[C_V] = f_C_V(Nb);

[L_V,nl] = f_L_V(Nb);
PP_MAT=ones(Nb/2+1,Nb+4);
PP_MAT(2:end,1)=5;
PP_MAT(end-1,2)=5;
PP_MAT(end,2:3)=5;
sign_pp=6*ones(1,Nb/2+1-1)

%% file di uscita
fp=fopen("../4_Design_and_Sim/src/multiplier/MBE_dadda.vhd",'w');
fp_pkg=fopen("../4_Design_and_Sim/src/common/MBE_pkg.vhd",'w');
f_entity_vhdl(fp,fp_pkg,Nb,nl);

%%

[Mult_VMAT] =f_Mult_VMAT(L_V, PP_MAT, nl, Nb, sign_pp,fp);
Str_Mult_VMAT = v_mat_to_strvmat(flip(Mult_VMAT,2));

[Mult_VMAT, Str_Mult_VMAT] =f_DADDA(Mult_VMAT, Str_Mult_VMAT, C_V, L_V, nl, Nb, fp);

Mult_VMAT=flip(Mult_VMAT,2);
n_l=length(Mult_VMAT(1,1,:));
n_r=length(Mult_VMAT(:,1,1));
n_c=length(Mult_VMAT(1,:,1));


% ciclo per sis
for l= 1:n_l    % ciclo si livelli
    for r= 1:n_r   % ciclo sulle righe
        str_r= (l-1)*(2*n_r+1) + r*2;  % r for string vector of mat
        line=split(Str_Mult_VMAT(str_r),"");
        to_line="";
        for c= 1:n_c % ciclo sulle colonne
            str_c1 = 2*c; % c for space between column
            str_c2 = 2*c+1; % c for string vector of mat, pi√π uno per il primo "" non usato
            to_line= to_line + line(str_c1) + num2str(Mult_VMAT(r,c,l));
        end
        to_line= to_line + line(end-1);
        Str_Mult_VMAT(str_r) = to_line;
    end
end

Mult_VMAT = flip(Mult_VMAT,2);

fprintf(fp,"\n");
fprintf(fp,'\n\n\t------------------------------------------\n');
fprintf(fp,'\t-- OUTPUTS\n');
fprintf(fp,'\t------------------------------------------\n\n');
fprintf(fp,"\t\tdata_out1 <= mult_vmat(nl-1,0);\n");
fprintf(fp,"\t\tdata_out2 <= mult_vmat(nl-1,1);\n");
fprintf(fp,"\n");
fprintf(fp,"END structure;");


fclose('all');

